
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Populations and Catalogs &#8212; Astrostatistics</title>
    
  <link href="_static/css/theme.css" rel="stylesheet">
  <link href="_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/togglebutton.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script async="async" src="https://unpkg.com/thebe@0.5.1/lib/index.js"></script>
    <script>
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Selection Effects" href="selection_effects.html" />
    <link rel="prev" title="Colored Noise" href="colored_noise.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="_static/logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Astrostatistics</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="intro.html">
   PHY 688: Numerical Methods in Astrophysics.
  </a>
 </li>
</ul>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="welcome.html">
   An Example to Set the Stage
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="syllabus.html">
   PHY 688: Computational Astrophysics Syllabus
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="regression_and_curve_fitting.html">
   Regression and Curve Fitting
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="colored_noise.html">
   Colored Noise
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Populations and Catalogs
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="selection_effects.html">
   Selection Effects
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="special_methods.html">
   Special Methods
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="tips_and_tricks.html">
   Tips and Tricks
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="project_ideas.html">
   Project Ideas
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="bibliography.html">
   Bibliography
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="_sources/populations.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/farr/Astrostatistics"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/farr/Astrostatistics/issues/new?title=Issue%20on%20page%20%2Fpopulations.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/farr/Astrostatistics/main?urlpath=tree/astrostatistics/populations.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="tex2jax_ignore mathjax_ignore section" id="populations-and-catalogs">
<h1>Populations and Catalogs<a class="headerlink" href="#populations-and-catalogs" title="Permalink to this headline">¶</a></h1>
<p>We will be working toward a full analysis of the mass function from <span id="id1">[<a class="reference internal" href="bibliography.html#id16">Schneider <em>et al.</em>, 2018</a>]</span>.  The data can be downloaded <a class="reference external" href="https://www.science.org/doi/10.1126/science.aan0106">here</a> and consist of estimates of the stellar properties of massive stars observed in the 30 Doradus star forming region with the VLT-FLAMES survey.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">pylab</span> inline
<span class="o">%</span><span class="k">config</span> InlineBackend.figure_format = &#39;svg&#39;
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Populating the interactive namespace from numpy and matplotlib
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">astropy.io.ascii</span> <span class="k">as</span> <span class="nn">aia</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">pymc3</span> <span class="k">as</span> <span class="nn">pm</span>
<span class="kn">import</span> <span class="nn">pymc3_ext</span> <span class="k">as</span> <span class="nn">pmx</span>
<span class="kn">import</span> <span class="nn">theano.tensor</span> <span class="k">as</span> <span class="nn">tt</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">gaussian_kde</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>

<span class="n">sns</span><span class="o">.</span><span class="n">set_context</span><span class="p">(</span><span class="s1">&#39;notebook&#39;</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">set_palette</span><span class="p">(</span><span class="s1">&#39;colorblind&#39;</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">set_style</span><span class="p">(</span><span class="s1">&#39;ticks&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_30dor</span> <span class="o">=</span> <span class="n">aia</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;data/aan0106_data_s1.txt&#39;</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span> 
                      <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;VFTS Identifier&#39;</span><span class="p">,</span> <span class="s1">&#39;Spectral type&#39;</span><span class="p">,</span> 
                             <span class="s1">&#39;logL&#39;</span><span class="p">,</span> <span class="s1">&#39;d+logL&#39;</span><span class="p">,</span> <span class="s1">&#39;d-logL&#39;</span><span class="p">,</span> <span class="s1">&#39;logLCI&#39;</span><span class="p">,</span> 
                             <span class="s1">&#39;Teff&#39;</span><span class="p">,</span> <span class="s1">&#39;d+Teff&#39;</span><span class="p">,</span> <span class="s1">&#39;d-Teff&#39;</span><span class="p">,</span> <span class="s1">&#39;TeffCI&#39;</span><span class="p">,</span> 
                             <span class="s1">&#39;logg&#39;</span><span class="p">,</span> <span class="s1">&#39;d+logg&#39;</span><span class="p">,</span> <span class="s1">&#39;d-logg&#39;</span><span class="p">,</span> <span class="s1">&#39;loggCI&#39;</span><span class="p">,</span>
                             <span class="s1">&#39;vsini&#39;</span><span class="p">,</span> <span class="s1">&#39;d+vsini&#39;</span><span class="p">,</span> <span class="s1">&#39;d-vsini&#39;</span><span class="p">,</span> <span class="s1">&#39;vsiniCI&#39;</span><span class="p">,</span>
                             <span class="s1">&#39;Y&#39;</span><span class="p">,</span> <span class="s1">&#39;d+Y&#39;</span><span class="p">,</span> <span class="s1">&#39;d-Y&#39;</span><span class="p">,</span> <span class="s1">&#39;YCI&#39;</span><span class="p">,</span>
                             <span class="s1">&#39;Reference&#39;</span><span class="p">,</span> 
                             <span class="s1">&#39;Mini&#39;</span><span class="p">,</span> <span class="s1">&#39;d+Mini&#39;</span><span class="p">,</span> <span class="s1">&#39;d-Mini&#39;</span><span class="p">,</span> <span class="s1">&#39;MiniCI&#39;</span><span class="p">,</span>
                             <span class="s1">&#39;vini&#39;</span><span class="p">,</span> <span class="s1">&#39;d+vini&#39;</span><span class="p">,</span> <span class="s1">&#39;d-vini&#39;</span><span class="p">,</span> <span class="s1">&#39;viniCI&#39;</span><span class="p">,</span>
                             <span class="s1">&#39;Age&#39;</span><span class="p">,</span> <span class="s1">&#39;d+Age&#39;</span><span class="p">,</span> <span class="s1">&#39;d-Age&#39;</span><span class="p">,</span> <span class="s1">&#39;AgeCI&#39;</span><span class="p">,</span>
                             <span class="s1">&#39;Mpresent&#39;</span><span class="p">,</span> <span class="s1">&#39;d+Mpresent&#39;</span><span class="p">,</span> <span class="s1">&#39;d-Mpresent&#39;</span><span class="p">,</span> <span class="s1">&#39;MpresentCI&#39;</span><span class="p">,</span>
                             <span class="s1">&#39;R&#39;</span><span class="p">,</span> <span class="s1">&#39;d+R&#39;</span><span class="p">,</span> <span class="s1">&#39;d-R&#39;</span><span class="p">,</span> <span class="s1">&#39;RCI&#39;</span><span class="p">],</span>
                      <span class="n">fill_values</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="s1">&#39;NaN&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;25.0-30.0&#39;</span><span class="p">,</span> <span class="s1">&#39;NaN&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;30.0-60.0&#39;</span><span class="p">,</span> <span class="s1">&#39;NaN&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;&gt;25.0&#39;</span><span class="p">,</span> <span class="s1">&#39;NaN&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;&gt;27.0&#39;</span><span class="p">,</span> <span class="s1">&#39;NaN&#39;</span><span class="p">),</span>
                                   <span class="p">(</span><span class="s1">&#39;18.5-47.7&#39;</span><span class="p">,</span> <span class="s1">&#39;NaN&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;16.5-41.8&#39;</span><span class="p">,</span> <span class="s1">&#39;NaN&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;7.9-12.9&#39;</span><span class="p">,</span> <span class="s1">&#39;NaN&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;25.8-54.1&#39;</span><span class="p">,</span> <span class="s1">&#39;NaN&#39;</span><span class="p">),</span>
                                   <span class="p">(</span><span class="s1">&#39;4.5-8.0&#39;</span><span class="p">,</span> <span class="s1">&#39;NaN&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;22.4-39.4&#39;</span><span class="p">,</span> <span class="s1">&#39;NaN&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;3.5-8.0&#39;</span><span class="p">,</span> <span class="s1">&#39;NaN&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;21.5-37.5&#39;</span><span class="p">,</span> <span class="s1">&#39;NaN&#39;</span><span class="p">),</span>
                                   <span class="p">(</span><span class="s1">&#39;17.0-30.6&#39;</span><span class="p">,</span> <span class="s1">&#39;NaN&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;12.7-22.1&#39;</span><span class="p">,</span> <span class="s1">&#39;NaN&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;7.3-11.8&#39;</span><span class="p">,</span> <span class="s1">&#39;NaN&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;5.7-9.0&#39;</span><span class="p">,</span> <span class="s1">&#39;NaN&#39;</span><span class="p">),</span>
                                   <span class="p">(</span><span class="s1">&#39;28.2-62.4&#39;</span><span class="p">,</span> <span class="s1">&#39;NaN&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;9.1-14.8&#39;</span><span class="p">,</span> <span class="s1">&#39;NaN&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;11.2-18.9&#39;</span><span class="p">,</span> <span class="s1">&#39;NaN&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;23.9-50.7&#39;</span><span class="p">,</span> <span class="s1">&#39;NaN&#39;</span><span class="p">),</span>
                                   <span class="p">(</span><span class="s1">&#39;10.6-17.8&#39;</span><span class="p">,</span> <span class="s1">&#39;NaN&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;20.2-35.8&#39;</span><span class="p">,</span> <span class="s1">&#39;NaN&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;8.3-13.5&#39;</span><span class="p">,</span> <span class="s1">&#39;NaN&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;6.0-9.5&#39;</span><span class="p">,</span> <span class="s1">&#39;NaN&#39;</span><span class="p">),</span>
                                   <span class="p">(</span><span class="s1">&#39;14.8-26.8&#39;</span><span class="p">,</span> <span class="s1">&#39;NaN&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;18.5-33.7&#39;</span><span class="p">,</span> <span class="s1">&#39;NaN&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;11.2-18.9&#39;</span><span class="p">,</span> <span class="s1">&#39;NaN&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;3.5-5.3&#39;</span><span class="p">,</span> <span class="s1">&#39;NaN&#39;</span><span class="p">),</span>
                                   <span class="p">(</span><span class="s1">&#39;47.9-79.6&#39;</span><span class="p">,</span> <span class="s1">&#39;NaN&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;47.8-79.6&#39;</span><span class="p">,</span> <span class="s1">&#39;NaN&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;4.6-7.1&#39;</span><span class="p">,</span> <span class="s1">&#39;NaN&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;5.5-8.8&#39;</span><span class="p">,</span> <span class="s1">&#39;NaN&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;16.0-54.2&#39;</span><span class="p">,</span> <span class="s1">&#39;NaN&#39;</span><span class="p">),</span>
                                   <span class="p">(</span><span class="s1">&#39;3.0-8.5&#39;</span><span class="p">,</span> <span class="s1">&#39;NaN&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;3.6-5.5&#39;</span><span class="p">,</span> <span class="s1">&#39;NaN&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;4.3-8.9&#39;</span><span class="p">,</span> <span class="s1">&#39;NaN&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;15.6-28.0&#39;</span><span class="p">,</span> <span class="s1">&#39;NaN&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;20.3-47.5&#39;</span><span class="p">,</span> <span class="s1">&#39;NaN&#39;</span><span class="p">),</span>
                                   <span class="p">(</span><span class="s1">&#39;16.1-28.0&#39;</span><span class="p">,</span> <span class="s1">&#39;NaN&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;11.0-18.4&#39;</span><span class="p">,</span> <span class="s1">&#39;NaN&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;4.1-6.3&#39;</span><span class="p">,</span> <span class="s1">&#39;NaN&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;14.5-33.8&#39;</span><span class="p">,</span> <span class="s1">&#39;NaN&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;12.7-22.1&#39;</span><span class="p">,</span> <span class="s1">&#39;NaN&#39;</span><span class="p">),</span>
                                   <span class="p">(</span><span class="s1">&#39;7.6-12.4&#39;</span><span class="p">,</span> <span class="s1">&#39;NaN&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;8.3-13.5&#39;</span><span class="p">,</span> <span class="s1">&#39;NaN&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;5.9-9.4&#39;</span><span class="p">,</span> <span class="s1">&#39;NaN&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;13.3-22.9&#39;</span><span class="p">,</span> <span class="s1">&#39;NaN&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;10.0-16.9&#39;</span><span class="p">,</span> <span class="s1">&#39;NaN&#39;</span><span class="p">),</span>
                                   <span class="p">(</span><span class="s1">&#39;12.7-22.1&#39;</span><span class="p">,</span> <span class="s1">&#39;NaN&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;5.9-9.4&#39;</span><span class="p">,</span> <span class="s1">&#39;NaN&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;12.3-20.7&#39;</span><span class="p">,</span> <span class="s1">&#39;NaN&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;21.5-39.4&#39;</span><span class="p">,</span> <span class="s1">&#39;NaN&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;14.1-23.9&#39;</span><span class="p">,</span> <span class="s1">&#39;NaN&#39;</span><span class="p">),</span>
                                   <span class="p">(</span><span class="s1">&#39;23.2-42.2&#39;</span><span class="p">,</span> <span class="s1">&#39;NaN&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;32.6-62.6&#39;</span><span class="p">,</span> <span class="s1">&#39;NaN&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;7.0-8.5&#39;</span><span class="p">,</span> <span class="s1">&#39;NaN&#39;</span><span class="p">)])</span><span class="o">.</span><span class="n">to_pandas</span><span class="p">()</span>
<span class="n">data_30dor</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>VFTS Identifier</th>
      <th>Spectral type</th>
      <th>logL</th>
      <th>d+logL</th>
      <th>d-logL</th>
      <th>logLCI</th>
      <th>Teff</th>
      <th>d+Teff</th>
      <th>d-Teff</th>
      <th>TeffCI</th>
      <th>...</th>
      <th>d-Age</th>
      <th>AgeCI</th>
      <th>Mpresent</th>
      <th>d+Mpresent</th>
      <th>d-Mpresent</th>
      <th>MpresentCI</th>
      <th>R</th>
      <th>d+R</th>
      <th>d-R</th>
      <th>RCI</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>3</td>
      <td>B1 Ia+</td>
      <td>6.03</td>
      <td>0.10</td>
      <td>0.10</td>
      <td>68.3</td>
      <td>21000.0</td>
      <td>1000.0</td>
      <td>1000.0</td>
      <td>68.3</td>
      <td>...</td>
      <td>0.3</td>
      <td>68.3</td>
      <td>56.4</td>
      <td>10.3</td>
      <td>7.8</td>
      <td>69.2</td>
      <td>74.2</td>
      <td>16.1</td>
      <td>9.2</td>
      <td>68.3</td>
    </tr>
    <tr>
      <th>1</th>
      <td>4</td>
      <td>B2 V</td>
      <td>3.85</td>
      <td>0.10</td>
      <td>0.10</td>
      <td>68.3</td>
      <td>20000.0</td>
      <td>1020.0</td>
      <td>1020.0</td>
      <td>68.3</td>
      <td>...</td>
      <td>3.3</td>
      <td>68.3</td>
      <td>8.0</td>
      <td>0.5</td>
      <td>0.4</td>
      <td>68.3</td>
      <td>5.7</td>
      <td>0.8</td>
      <td>0.6</td>
      <td>68.3</td>
    </tr>
    <tr>
      <th>2</th>
      <td>5</td>
      <td>B2 V(n)</td>
      <td>3.82</td>
      <td>0.10</td>
      <td>0.10</td>
      <td>68.3</td>
      <td>19000.0</td>
      <td>1000.0</td>
      <td>1000.0</td>
      <td>68.3</td>
      <td>...</td>
      <td>3.0</td>
      <td>68.3</td>
      <td>8.0</td>
      <td>0.4</td>
      <td>0.6</td>
      <td>68.3</td>
      <td>7.7</td>
      <td>0.9</td>
      <td>0.7</td>
      <td>68.3</td>
    </tr>
    <tr>
      <th>3</th>
      <td>6</td>
      <td>Mid-late K</td>
      <td>3.46</td>
      <td>0.20</td>
      <td>0.20</td>
      <td>68.3</td>
      <td>4100.0</td>
      <td>150.0</td>
      <td>150.0</td>
      <td>68.3</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>4</th>
      <td>7</td>
      <td>B1-2 V</td>
      <td>3.64</td>
      <td>0.11</td>
      <td>0.11</td>
      <td>68.3</td>
      <td>20000.0</td>
      <td>1210.0</td>
      <td>1210.0</td>
      <td>68.3</td>
      <td>...</td>
      <td>4.2</td>
      <td>68.3</td>
      <td>7.4</td>
      <td>0.4</td>
      <td>0.6</td>
      <td>68.3</td>
      <td>5.7</td>
      <td>0.8</td>
      <td>0.6</td>
      <td>68.3</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>566</th>
      <td>1001</td>
      <td>WN6(h)</td>
      <td>6.20</td>
      <td>0.10</td>
      <td>0.10</td>
      <td>68.3</td>
      <td>42170.0</td>
      <td>1520.0</td>
      <td>1520.0</td>
      <td>68.3</td>
      <td>...</td>
      <td>0.3</td>
      <td>68.3</td>
      <td>57.6</td>
      <td>11.6</td>
      <td>6.5</td>
      <td>68.3</td>
      <td>27.7</td>
      <td>2.8</td>
      <td>4.5</td>
      <td>68.3</td>
    </tr>
    <tr>
      <th>567</th>
      <td>1017</td>
      <td>O2 If*/WN5</td>
      <td>6.21</td>
      <td>0.10</td>
      <td>0.10</td>
      <td>68.3</td>
      <td>50120.0</td>
      <td>1800.0</td>
      <td>1800.0</td>
      <td>68.3</td>
      <td>...</td>
      <td>0.4</td>
      <td>68.3</td>
      <td>79.0</td>
      <td>17.8</td>
      <td>15.9</td>
      <td>69.9</td>
      <td>16.9</td>
      <td>2.7</td>
      <td>2.7</td>
      <td>68.3</td>
    </tr>
    <tr>
      <th>568</th>
      <td>1021</td>
      <td>O4 If+</td>
      <td>6.10</td>
      <td>0.10</td>
      <td>0.10</td>
      <td>68.3</td>
      <td>35500.0</td>
      <td>1500.0</td>
      <td>1500.0</td>
      <td>68.3</td>
      <td>...</td>
      <td>0.2</td>
      <td>68.3</td>
      <td>71.4</td>
      <td>12.7</td>
      <td>9.2</td>
      <td>68.5</td>
      <td>30.1</td>
      <td>4.2</td>
      <td>3.3</td>
      <td>68.3</td>
    </tr>
    <tr>
      <th>569</th>
      <td>1022</td>
      <td>O3.5 If*/WN7</td>
      <td>6.48</td>
      <td>0.10</td>
      <td>0.10</td>
      <td>68.3</td>
      <td>42170.0</td>
      <td>1520.0</td>
      <td>1520.0</td>
      <td>68.3</td>
      <td>...</td>
      <td>0.1</td>
      <td>68.3</td>
      <td>142.8</td>
      <td>25.6</td>
      <td>25.2</td>
      <td>68.3</td>
      <td>32.5</td>
      <td>4.7</td>
      <td>4.4</td>
      <td>68.3</td>
    </tr>
    <tr>
      <th>570</th>
      <td>1025</td>
      <td>WN5h</td>
      <td>6.58</td>
      <td>0.15</td>
      <td>0.15</td>
      <td>68.3</td>
      <td>42170.0</td>
      <td>1890.0</td>
      <td>1890.0</td>
      <td>68.3</td>
      <td>...</td>
      <td>0.2</td>
      <td>68.3</td>
      <td>142.0</td>
      <td>32.7</td>
      <td>24.7</td>
      <td>68.3</td>
      <td>40.7</td>
      <td>5.7</td>
      <td>6.3</td>
      <td>68.3</td>
    </tr>
  </tbody>
</table>
<p>571 rows × 43 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sns</span><span class="o">.</span><span class="n">kdeplot</span><span class="p">(</span><span class="n">data_30dor</span><span class="p">[</span><span class="s1">&#39;Mini&#39;</span><span class="p">],</span> <span class="n">log_scale</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Observed&#39;</span><span class="p">)</span>
<span class="n">ms</span> <span class="o">=</span> <span class="n">exp</span><span class="p">(</span><span class="n">linspace</span><span class="p">(</span><span class="n">log</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span> <span class="n">log</span><span class="p">(</span><span class="mi">300</span><span class="p">),</span> <span class="mi">100</span><span class="p">))</span>
<span class="n">plot</span><span class="p">(</span><span class="n">ms</span><span class="p">,</span> <span class="mi">100</span><span class="o">*</span><span class="n">ms</span><span class="o">*</span><span class="n">ms</span><span class="o">**-</span><span class="mf">2.35</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$\mathrm</span><span class="si">{d}</span><span class="s1">N/\mathrm</span><span class="si">{d}</span><span class="s1">m \sim m^{-2.35}$&#39;</span><span class="p">)</span>
<span class="n">yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
<span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$M_\mathrm</span><span class="si">{ZAMS}</span><span class="s1"> / M_\odot$&#39;</span><span class="p">)</span>
<span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.legend.Legend at 0x14534cc70&gt;
</pre></div>
</div>
<img alt="_images/populations_5_1.svg" src="_images/populations_5_1.svg" /></div>
</div>
<p>In class we derived the inhomogeneous Poisson likelihood.  For stars that occur with a I.H.P. rate (aka “intensity”)
$<span class="math notranslate nohighlight">\(
\frac{\mathrm{d} N}{\mathrm{d} m} 
\)</span><span class="math notranslate nohighlight">\(
the likelihood for observations \)</span>m_i<span class="math notranslate nohighlight">\( is 
\)</span><span class="math notranslate nohighlight">\(
p\left( \left\{ m_i \mid i = 1, \ldots, n \right\} \mid \ldots \right) = \exp\left( - N \right) \prod_{i=1}^n \frac{\mathrm{d} N}{\mathrm{d} m_i };
\)</span><span class="math notranslate nohighlight">\(
here the \)</span>\ldots$ stand in for whatever parameters we need to specify the intensity.</p>
<p>Let’s fit a power-law intensity to the <span class="math notranslate nohighlight">\(m\)</span> estimates from <span id="id2">[<a class="reference internal" href="bibliography.html#id16">Schneider <em>et al.</em>, 2018</a>]</span>.  We will parameterize the power law by
$<span class="math notranslate nohighlight">\(
\frac{\mathrm{d} N}{\mathrm{d} m} = \frac{A}{m_\mathrm{min}} \left( \frac{m}{m_\mathrm{min}} \right)^{-\alpha}.
\)</span><span class="math notranslate nohighlight">\(
Here \)</span>A<span class="math notranslate nohighlight">\(, an &quot;amplitude&quot; parameter, corresponds to the differential star formation rate *per (natural) log mass* at \)</span>m = m_\mathrm{min}<span class="math notranslate nohighlight">\(:
\)</span><span class="math notranslate nohighlight">\(
\left. m \frac{\mathrm{d} N}{\mathrm{d} m} \right|_{m = m_\mathrm{min}} = \left. \frac{\mathrm{d} N}{\mathrm{d} \ln m} \right|_{m = m_\mathrm{min}} = A
\)</span><span class="math notranslate nohighlight">\(
the &quot;power law slope&quot; is \)</span>-\alpha<span class="math notranslate nohighlight">\(.  We will fix \)</span>m_\mathrm{min} = 20 , M_\odot<span class="math notranslate nohighlight">\( is our analysis because we are not yet ready to face the selection effects plaguing lower masses (lower mass stars are dimmer, and therefore harder to obtain spectra for, and therefore appear under-represented in the above data set), and it looks like the observations are approximately power-law for \)</span>m &gt; 20 , M_\odot$.</p>
<p>We will need the integral of the intensity:
$<span class="math notranslate nohighlight">\(
\Lambda \equiv \int_{m_\mathrm{min}}^\infty \mathrm{d} m \, \frac{\mathrm{d}N}{\mathrm{d} m} = \frac{A}{\alpha-1}
\)</span><span class="math notranslate nohighlight">\(
as long as \)</span>\alpha &gt; 1<span class="math notranslate nohighlight">\(.  As long as \)</span>\alpha \simeq 1<span class="math notranslate nohighlight">\(, we expect that \)</span>A<span class="math notranslate nohighlight">\( will be comparable to the total number of observations (\)</span>\sim 500<span class="math notranslate nohighlight">\( in total, though only about 140 with masses above \)</span>20 , M_\odot$).</p>
<p>In order to make nice plots, we produce <span class="math notranslate nohighlight">\(\mathrm{d} N/\mathrm{d} m\)</span> on a grid of masses as a deterministic output of the model (we could produce this after the fact, but doing it this way ensures that the output <span class="math notranslate nohighlight">\(\mathrm{d}N/\mathrm{d}m\)</span> and the inferred shape function are consistent, including the normalization term).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">MMin</span> <span class="o">=</span> <span class="mi">20</span>
<span class="n">masses</span> <span class="o">=</span> <span class="n">data_30dor</span><span class="p">[</span><span class="s1">&#39;Mini&#39;</span><span class="p">]</span>
<span class="n">masses</span> <span class="o">=</span> <span class="n">masses</span><span class="p">[(</span><span class="o">~</span><span class="n">isnan</span><span class="p">(</span><span class="n">masses</span><span class="p">))</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">masses</span> <span class="o">&gt;</span> <span class="n">MMin</span><span class="p">)]</span>

<span class="n">mgrid</span> <span class="o">=</span> <span class="n">exp</span><span class="p">(</span><span class="n">arange</span><span class="p">(</span><span class="n">log</span><span class="p">(</span><span class="n">MMin</span><span class="p">),</span> <span class="n">log</span><span class="p">(</span><span class="mi">500</span><span class="p">),</span> <span class="mf">0.01</span><span class="p">))</span>

<span class="k">with</span> <span class="n">pm</span><span class="o">.</span><span class="n">Model</span><span class="p">()</span> <span class="k">as</span> <span class="n">salp_model</span><span class="p">:</span>
    <span class="c1"># dN/dm = (A/20)*(m/20)^-alpha</span>
    <span class="n">alpha</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Bound</span><span class="p">(</span><span class="n">pm</span><span class="o">.</span><span class="n">Normal</span><span class="p">,</span> <span class="n">lower</span><span class="o">=</span><span class="mi">1</span><span class="p">)(</span><span class="s1">&#39;alpha&#39;</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="mf">2.5</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">A</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Lognormal</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="n">log</span><span class="p">(</span><span class="mi">140</span><span class="p">),</span> <span class="n">sigma</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">log_dNdm</span><span class="p">(</span><span class="n">m</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">tt</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">A</span><span class="p">)</span> <span class="o">-</span> <span class="n">tt</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">MMin</span><span class="p">)</span> <span class="o">-</span> <span class="n">alpha</span><span class="o">*</span><span class="p">(</span><span class="n">tt</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="o">-</span> <span class="n">tt</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">MMin</span><span class="p">))</span>
    
    <span class="n">Lambda</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Deterministic</span><span class="p">(</span><span class="s1">&#39;Lambda&#39;</span><span class="p">,</span> <span class="n">A</span><span class="o">/</span><span class="p">(</span><span class="n">alpha</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
    
    <span class="c1"># sum(log(dN/dm_i)) - Lambda</span>
    <span class="n">pm</span><span class="o">.</span><span class="n">Potential</span><span class="p">(</span><span class="s1">&#39;likelihood&#39;</span><span class="p">,</span> <span class="n">tt</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">log_dNdm</span><span class="p">(</span><span class="n">masses</span><span class="p">)))</span>
    <span class="n">pm</span><span class="o">.</span><span class="n">Potential</span><span class="p">(</span><span class="s1">&#39;normalization&#39;</span><span class="p">,</span> <span class="o">-</span><span class="n">Lambda</span><span class="p">)</span>
    
    <span class="n">dNdm_grid</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Deterministic</span><span class="p">(</span><span class="s1">&#39;dNdm_grid&#39;</span><span class="p">,</span> <span class="n">exp</span><span class="p">(</span><span class="n">log_dNdm</span><span class="p">(</span><span class="n">mgrid</span><span class="p">)))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">salp_model</span><span class="p">:</span>
    <span class="n">salp_trace</span> <span class="o">=</span> <span class="n">pmx</span><span class="o">.</span><span class="n">sample</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/Users/wfarr/miniconda3/envs/Astrostatistics688/lib/python3.9/site-packages/pymc3_ext/sampling/sampling.py:97: FutureWarning: In v4.0, pm.sample will return an `arviz.InferenceData` object instead of a `MultiTrace` by default. You can pass return_inferencedata=True or return_inferencedata=False to be safe and silence this warning.
  return pm.sample(draws=draws, tune=tune, model=model, step=step, **kwargs)
Multiprocess sampling (2 chains in 2 jobs)
NUTS: [A, alpha]
</pre></div>
</div>
<div class="output text_html">
<div>
    <style>
        /* Turns off some styling */
        progress {
            /* gets rid of default border in Firefox and Opera. */
            border: none;
            /* Needs to be in here for Safari polyfill so background images work as expected. */
            background-size: auto;
        }
        .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
            background: #F44336;
        }
    </style>
  <progress value='4000' class='' max='4000' style='width:300px; height:20px; vertical-align: middle;'></progress>
  100.00% [4000/4000 00:05<00:00 Sampling 2 chains, 0 divergences]
</div>
</div><div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Sampling 2 chains for 1_000 tune and 1_000 draw iterations (2_000 + 2_000 draws total) took 23 seconds.
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">salp_model</span><span class="p">:</span>
    <span class="n">pm</span><span class="o">.</span><span class="n">plot_trace</span><span class="p">(</span><span class="n">salp_trace</span><span class="p">,</span> <span class="n">var_names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">,</span> <span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;Lambda&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/populations_9_0.svg" src="_images/populations_9_0.svg" /></div>
</div>
<p>Let’s plot the inferred intensity and compare to the observed intensity.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">all_valid_masses</span> <span class="o">=</span> <span class="n">data_30dor</span><span class="p">[</span><span class="s1">&#39;Mini&#39;</span><span class="p">]</span>
<span class="n">all_valid_masses</span> <span class="o">=</span> <span class="n">all_valid_masses</span><span class="p">[</span><span class="o">~</span><span class="n">isnan</span><span class="p">(</span><span class="n">all_valid_masses</span><span class="p">)]</span>
<span class="n">logm_density</span> <span class="o">=</span> <span class="n">gaussian_kde</span><span class="p">(</span><span class="n">log</span><span class="p">(</span><span class="n">all_valid_masses</span><span class="p">))</span>

<span class="n">plot</span><span class="p">(</span><span class="n">mgrid</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">all_valid_masses</span><span class="p">)</span><span class="o">*</span><span class="n">logm_density</span><span class="p">(</span><span class="n">log</span><span class="p">(</span><span class="n">mgrid</span><span class="p">)),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Observed&#39;</span><span class="p">)</span>

<span class="n">l</span><span class="p">,</span> <span class="o">=</span> <span class="n">plot</span><span class="p">(</span><span class="n">mgrid</span><span class="p">,</span> <span class="n">mgrid</span><span class="o">*</span><span class="n">median</span><span class="p">(</span><span class="n">salp_trace</span><span class="p">[</span><span class="s1">&#39;dNdm_grid&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Fit&#39;</span><span class="p">)</span>
<span class="n">fill_between</span><span class="p">(</span><span class="n">mgrid</span><span class="p">,</span> <span class="n">mgrid</span><span class="o">*</span><span class="n">quantile</span><span class="p">(</span><span class="n">salp_trace</span><span class="p">[</span><span class="s1">&#39;dNdm_grid&#39;</span><span class="p">],</span> <span class="mf">0.84</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="n">mgrid</span><span class="o">*</span><span class="n">quantile</span><span class="p">(</span><span class="n">salp_trace</span><span class="p">[</span><span class="s1">&#39;dNdm_grid&#39;</span><span class="p">],</span> <span class="mf">0.16</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">l</span><span class="o">.</span><span class="n">get_color</span><span class="p">())</span>
<span class="n">fill_between</span><span class="p">(</span><span class="n">mgrid</span><span class="p">,</span> <span class="n">mgrid</span><span class="o">*</span><span class="n">quantile</span><span class="p">(</span><span class="n">salp_trace</span><span class="p">[</span><span class="s1">&#39;dNdm_grid&#39;</span><span class="p">],</span> <span class="mf">0.975</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="n">mgrid</span><span class="o">*</span><span class="n">quantile</span><span class="p">(</span><span class="n">salp_trace</span><span class="p">[</span><span class="s1">&#39;dNdm_grid&#39;</span><span class="p">],</span> <span class="mf">0.025</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">l</span><span class="o">.</span><span class="n">get_color</span><span class="p">())</span>

<span class="n">axis</span><span class="p">(</span><span class="n">ymin</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
<span class="n">xscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
<span class="n">yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>

<span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$m / M_\odot$&#39;</span><span class="p">)</span>
<span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$m \mathrm</span><span class="si">{d}</span><span class="s1"> N / \mathrm</span><span class="si">{d}</span><span class="s1"> m$&#39;</span><span class="p">)</span>

<span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.legend.Legend at 0x147961ee0&gt;
</pre></div>
</div>
<img alt="_images/populations_11_1.svg" src="_images/populations_11_1.svg" /></div>
</div>
<p>Now let’s take into account that the masses are <em>estimated</em> with uncertanty; the <em>unknown</em> true masses will follow a power law, with the observed masses related to the true masses by a Gaussian likelihood:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">MMin</span> <span class="o">=</span> <span class="mi">20</span>
<span class="n">mask</span> <span class="o">=</span> <span class="p">(</span><span class="o">~</span><span class="n">isnan</span><span class="p">(</span><span class="n">data_30dor</span><span class="p">[</span><span class="s1">&#39;Mini&#39;</span><span class="p">]))</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">data_30dor</span><span class="p">[</span><span class="s1">&#39;Mini&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">MMin</span><span class="p">)</span>
<span class="n">obs_masses</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data_30dor</span><span class="p">[</span><span class="s1">&#39;Mini&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">mask</span><span class="p">])</span>
<span class="n">sigma_masses</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">data_30dor</span><span class="p">[</span><span class="s1">&#39;d+Mini&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">+</span> <span class="n">data_30dor</span><span class="p">[</span><span class="s1">&#39;d-Mini&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">mask</span><span class="p">]))</span>

<span class="n">mgrid</span> <span class="o">=</span> <span class="n">exp</span><span class="p">(</span><span class="n">arange</span><span class="p">(</span><span class="n">log</span><span class="p">(</span><span class="n">MMin</span><span class="p">),</span> <span class="n">log</span><span class="p">(</span><span class="mi">500</span><span class="p">),</span> <span class="mf">0.01</span><span class="p">))</span>

<span class="k">with</span> <span class="n">pm</span><span class="o">.</span><span class="n">Model</span><span class="p">()</span> <span class="k">as</span> <span class="n">salp_model_hier</span><span class="p">:</span>
    <span class="c1"># dN/dm = (A/20)*(m/20)^-alpha</span>
    <span class="n">alpha</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Bound</span><span class="p">(</span><span class="n">pm</span><span class="o">.</span><span class="n">Normal</span><span class="p">,</span> <span class="n">lower</span><span class="o">=</span><span class="mi">1</span><span class="p">)(</span><span class="s1">&#39;alpha&#39;</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="mf">2.5</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">A</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Lognormal</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="n">log</span><span class="p">(</span><span class="mi">140</span><span class="p">),</span> <span class="n">sigma</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">true_masses</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Bound</span><span class="p">(</span><span class="n">pm</span><span class="o">.</span><span class="n">Flat</span><span class="p">,</span> <span class="n">lower</span><span class="o">=</span><span class="n">MMin</span><span class="p">)(</span><span class="s1">&#39;true_masses&#39;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">obs_masses</span><span class="p">))</span>
    
    <span class="k">def</span> <span class="nf">log_dNdm</span><span class="p">(</span><span class="n">m</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">tt</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">A</span><span class="p">)</span> <span class="o">-</span> <span class="n">tt</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">MMin</span><span class="p">)</span> <span class="o">-</span> <span class="n">alpha</span><span class="o">*</span><span class="p">(</span><span class="n">tt</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="o">-</span> <span class="n">tt</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">MMin</span><span class="p">))</span>
    
    <span class="n">Lambda</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Deterministic</span><span class="p">(</span><span class="s1">&#39;Lambda&#39;</span><span class="p">,</span> <span class="n">A</span><span class="o">/</span><span class="p">(</span><span class="n">alpha</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
    
    <span class="c1"># sum(log(dN/dm_i)) - Lambda</span>
    <span class="n">pm</span><span class="o">.</span><span class="n">Potential</span><span class="p">(</span><span class="s1">&#39;likelihood&#39;</span><span class="p">,</span> <span class="n">tt</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">log_dNdm</span><span class="p">(</span><span class="n">true_masses</span><span class="p">)))</span>
    <span class="n">pm</span><span class="o">.</span><span class="n">Potential</span><span class="p">(</span><span class="s1">&#39;normalization&#39;</span><span class="p">,</span> <span class="o">-</span><span class="n">Lambda</span><span class="p">)</span>
    
    <span class="n">pm</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="s1">&#39;obs_likelihood&#39;</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="n">true_masses</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="n">sigma_masses</span><span class="p">,</span> <span class="n">observed</span><span class="o">=</span><span class="n">obs_masses</span><span class="p">)</span>
    
    <span class="n">dNdm_grid</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Deterministic</span><span class="p">(</span><span class="s1">&#39;dNdm_grid&#39;</span><span class="p">,</span> <span class="n">exp</span><span class="p">(</span><span class="n">log_dNdm</span><span class="p">(</span><span class="n">mgrid</span><span class="p">)))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">salp_model_hier</span><span class="p">:</span>
    <span class="n">salp_trace_hier</span> <span class="o">=</span> <span class="n">pmx</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">init</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;true_masses&#39;</span><span class="p">:</span> <span class="n">obs_masses</span><span class="p">},</span> <span class="n">adapt_type</span><span class="o">=</span><span class="s1">&#39;diag&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/Users/wfarr/miniconda3/envs/Astrostatistics688/lib/python3.9/site-packages/pymc3_ext/sampling/sampling.py:97: FutureWarning: In v4.0, pm.sample will return an `arviz.InferenceData` object instead of a `MultiTrace` by default. You can pass return_inferencedata=True or return_inferencedata=False to be safe and silence this warning.
  return pm.sample(draws=draws, tune=tune, model=model, step=step, **kwargs)
Multiprocess sampling (2 chains in 2 jobs)
NUTS: [true_masses, A, alpha]
</pre></div>
</div>
<div class="output text_html">
<div>
    <style>
        /* Turns off some styling */
        progress {
            /* gets rid of default border in Firefox and Opera. */
            border: none;
            /* Needs to be in here for Safari polyfill so background images work as expected. */
            background-size: auto;
        }
        .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
            background: #F44336;
        }
    </style>
  <progress value='4000' class='' max='4000' style='width:300px; height:20px; vertical-align: middle;'></progress>
  100.00% [4000/4000 00:18<00:00 Sampling 2 chains, 0 divergences]
</div>
</div><div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Sampling 2 chains for 1_000 tune and 1_000 draw iterations (2_000 + 2_000 draws total) took 35 seconds.
The number of effective samples is smaller than 25% for some parameters.
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">salp_model_hier</span><span class="p">:</span>
    <span class="n">pm</span><span class="o">.</span><span class="n">plot_trace</span><span class="p">(</span><span class="n">salp_trace_hier</span><span class="p">,</span> <span class="n">var_names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;alpha&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/populations_15_0.svg" src="_images/populations_15_0.svg" /></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">all_valid_masses</span> <span class="o">=</span> <span class="n">data_30dor</span><span class="p">[</span><span class="s1">&#39;Mini&#39;</span><span class="p">]</span>
<span class="n">all_valid_masses</span> <span class="o">=</span> <span class="n">all_valid_masses</span><span class="p">[</span><span class="o">~</span><span class="n">isnan</span><span class="p">(</span><span class="n">all_valid_masses</span><span class="p">)]</span>
<span class="n">logm_density</span> <span class="o">=</span> <span class="n">gaussian_kde</span><span class="p">(</span><span class="n">log</span><span class="p">(</span><span class="n">all_valid_masses</span><span class="p">))</span>

<span class="n">logm_true_density</span> <span class="o">=</span> <span class="n">gaussian_kde</span><span class="p">(</span><span class="n">log</span><span class="p">(</span><span class="n">salp_trace_hier</span><span class="p">[</span><span class="s1">&#39;true_masses&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">ravel</span><span class="p">()))</span>

<span class="n">plot</span><span class="p">(</span><span class="n">mgrid</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">all_valid_masses</span><span class="p">)</span><span class="o">*</span><span class="n">logm_density</span><span class="p">(</span><span class="n">log</span><span class="p">(</span><span class="n">mgrid</span><span class="p">)),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Observed&#39;</span><span class="p">)</span>
<span class="n">plot</span><span class="p">(</span><span class="n">mgrid</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">obs_masses</span><span class="p">)</span><span class="o">*</span><span class="n">logm_true_density</span><span class="p">(</span><span class="n">log</span><span class="p">(</span><span class="n">mgrid</span><span class="p">)),</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Inferred Masses&#39;</span><span class="p">)</span>

<span class="n">l</span><span class="p">,</span> <span class="o">=</span> <span class="n">plot</span><span class="p">(</span><span class="n">mgrid</span><span class="p">,</span> <span class="n">mgrid</span><span class="o">*</span><span class="n">median</span><span class="p">(</span><span class="n">salp_trace_hier</span><span class="p">[</span><span class="s1">&#39;dNdm_grid&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Fit&#39;</span><span class="p">)</span>
<span class="n">fill_between</span><span class="p">(</span><span class="n">mgrid</span><span class="p">,</span> <span class="n">mgrid</span><span class="o">*</span><span class="n">quantile</span><span class="p">(</span><span class="n">salp_trace_hier</span><span class="p">[</span><span class="s1">&#39;dNdm_grid&#39;</span><span class="p">],</span> <span class="mf">0.84</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="n">mgrid</span><span class="o">*</span><span class="n">quantile</span><span class="p">(</span><span class="n">salp_trace_hier</span><span class="p">[</span><span class="s1">&#39;dNdm_grid&#39;</span><span class="p">],</span> <span class="mf">0.16</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">l</span><span class="o">.</span><span class="n">get_color</span><span class="p">())</span>
<span class="n">fill_between</span><span class="p">(</span><span class="n">mgrid</span><span class="p">,</span> <span class="n">mgrid</span><span class="o">*</span><span class="n">quantile</span><span class="p">(</span><span class="n">salp_trace_hier</span><span class="p">[</span><span class="s1">&#39;dNdm_grid&#39;</span><span class="p">],</span> <span class="mf">0.975</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="n">mgrid</span><span class="o">*</span><span class="n">quantile</span><span class="p">(</span><span class="n">salp_trace_hier</span><span class="p">[</span><span class="s1">&#39;dNdm_grid&#39;</span><span class="p">],</span> <span class="mf">0.025</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">l</span><span class="o">.</span><span class="n">get_color</span><span class="p">())</span>

<span class="n">axis</span><span class="p">(</span><span class="n">ymin</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
<span class="n">xscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
<span class="n">yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>

<span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$m / M_\odot$&#39;</span><span class="p">)</span>
<span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$m \mathrm</span><span class="si">{d}</span><span class="s1"> N / \mathrm</span><span class="si">{d}</span><span class="s1"> m$&#39;</span><span class="p">)</span>

<span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.legend.Legend at 0x151ca1dc0&gt;
</pre></div>
</div>
<img alt="_images/populations_16_1.svg" src="_images/populations_16_1.svg" /></div>
</div>
<p>Next steps:</p>
<ul class="simple">
<li><p>Broken power law.</p></li>
<li><p>What about high-mass absence from aging?</p></li>
<li><p><em><strong>Selection Effects</strong></em> (handle the mass boundary appropriately).</p></li>
</ul>
<p>Here we will account for the finite and <em>mass-dependent</em> stellar lifetime that reduces the number of high-mass stars in our sample, and therefore steepens the slope.  We assume that stars form in a Poisson process in <em>mass</em> and in <em>time</em> via
$<span class="math notranslate nohighlight">\(
\frac{\mathrm{d} N}{\mathrm{d} m \mathrm{d} t} = \frac{A}{m} \left( \frac{m}{m_\mathrm{min}} \right)^{-\alpha} \exp\left( - \frac{\left( t - \mu_t\right)^2}{2 \sigma_t^2} \right).
\)</span><span class="math notranslate nohighlight">\(
Here \)</span>A<span class="math notranslate nohighlight">\( is the number of stars formed per natural log mass per time at \)</span>m = m_\mathrm{min}<span class="math notranslate nohighlight">\( and \)</span>t = \mu_t$ (that is, at time of the peak star formation rate).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mask</span> <span class="o">=</span> <span class="p">(</span><span class="o">~</span><span class="n">isnan</span><span class="p">(</span><span class="n">data_30dor</span><span class="p">[</span><span class="s1">&#39;Mini&#39;</span><span class="p">]))</span> <span class="o">&amp;</span> <span class="p">(</span><span class="o">~</span><span class="n">isnan</span><span class="p">(</span><span class="n">data_30dor</span><span class="p">[</span><span class="s1">&#39;Age&#39;</span><span class="p">]))</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">data_30dor</span><span class="p">[</span><span class="s1">&#39;Age&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pg</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">PairGrid</span><span class="p">(</span><span class="n">data_30dor</span><span class="p">[</span><span class="n">mask</span><span class="p">],</span> <span class="nb">vars</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Mini&#39;</span><span class="p">,</span> <span class="s1">&#39;Age&#39;</span><span class="p">],</span> <span class="n">corner</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">pg</span><span class="o">.</span><span class="n">map_diag</span><span class="p">(</span><span class="n">sns</span><span class="o">.</span><span class="n">kdeplot</span><span class="p">)</span>
<span class="n">pg</span><span class="o">.</span><span class="n">map_lower</span><span class="p">(</span><span class="n">scatter</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
<span class="n">pg</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$M/M_\odot$&#39;</span><span class="p">)</span>
<span class="n">pg</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$t / \mathrm</span><span class="si">{Myr}</span><span class="s1">$&#39;</span><span class="p">)</span>
<span class="n">pg</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$t / \mathrm</span><span class="si">{Myr}</span><span class="s1">$&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0.5, 21.500000000000043, &#39;$t / \\mathrm{Myr}$&#39;)
</pre></div>
</div>
<img alt="_images/populations_20_1.svg" src="_images/populations_20_1.svg" /></div>
</div>
<p>If we zoom in on the lower-mass part of the plot here, we see that for sufficiently low masses, there is a one-to-one relationship between the mass and the age; this is a result of the giant branch: for these low-mass stars, they can only be seen when they are in the giant phase, which is quite short, so there is one, definite formation time that puts the star on the giant branch today.  We want to cut out these stars, since they do not give us a continuous picture of the mass and time evolution of the star formation; we can accomplish this by cutting out stars below <span class="math notranslate nohighlight">\(\sim 15 \, M_\odot\)</span>.</p>
<p>A crucial parameter is the maximum age of any star at a given mass before it becomes a compact remnant.  This can be found in <span id="id3">[<a class="reference internal" href="bibliography.html#id17">Farr and Mandel, 2018</a>]</span>; their fitting formula for the main-sequence lifetime as a function of mass is
$<span class="math notranslate nohighlight">\(
\log \frac{\tau\left( M \right)}{\mathrm{Myr}} = 9.1973 - 3.8955 \log \frac{M}{M_\odot} + 0.6107 \left( \log \frac{M}{M_\odot} \right)^2 - 0.0332 \left( \log \frac{M}{M_\odot} \right)^3.
\)</span>$
The full lifetime is 10% longer than the main sequence lifetime to account for the post-main-sequence helium burning in these massive stars.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">lifetime</span><span class="p">(</span><span class="n">M</span><span class="p">):</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">tt</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">M</span><span class="p">)</span>
    <span class="k">return</span> <span class="mf">1.1</span><span class="o">*</span><span class="n">tt</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mf">9.1973</span> <span class="o">+</span> <span class="n">x</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="mf">3.8955</span> <span class="o">+</span> <span class="n">x</span><span class="o">*</span><span class="p">(</span><span class="mf">0.6107</span> <span class="o">-</span> <span class="n">x</span><span class="o">*</span><span class="mf">0.0332</span><span class="p">)))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">scatter</span><span class="p">(</span><span class="n">data_30dor</span><span class="p">[</span><span class="s1">&#39;Mini&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">mask</span><span class="p">],</span> <span class="n">data_30dor</span><span class="p">[</span><span class="s1">&#39;Age&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">mask</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Observations&#39;</span><span class="p">)</span>

<span class="n">m</span> <span class="o">=</span> <span class="n">exp</span><span class="p">(</span><span class="n">linspace</span><span class="p">(</span><span class="n">log</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span> <span class="n">log</span><span class="p">(</span><span class="mi">200</span><span class="p">),</span> <span class="mi">1024</span><span class="p">))</span>
<span class="n">plot</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">lifetime</span><span class="p">(</span><span class="n">m</span><span class="p">)</span><span class="o">.</span><span class="n">eval</span><span class="p">(),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Maximum Stellar Lifetime&#39;</span><span class="p">)</span>

<span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">)</span>

<span class="n">xscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
<span class="n">yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
<span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$M / M_\odot$&#39;</span><span class="p">)</span>
<span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$t / \mathrm</span><span class="si">{Myr}</span><span class="s1">$&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0, 0.5, &#39;$t / \\mathrm{Myr}$&#39;)
</pre></div>
</div>
<img alt="_images/populations_24_1.svg" src="_images/populations_24_1.svg" /></div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        
            <!-- Previous / next buttons -->
<div class='prev-next-area'> 
    <a class='left-prev' id="prev-link" href="colored_noise.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Colored Noise</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="selection_effects.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Selection Effects</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
        
        </div>
    </div>
    <footer class="footer">
    <div class="container">
      <p>
        
          By Will M. Farr<br/>
        
            &copy; Copyright 2021.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="_static/js/index.be7d3bbb2ef33a8344ce.js"></script>

  </body>
</html>